name: Setup

on:
  workflow_call:

jobs:
  setup:
    runs-on: ubuntu-latest
    env:
      PR_NUMBER: ${{ github.event.number || github.event.inputs.prNumber }}
    outputs:
      pr-number: ${{ steps.build-step.outputs.pr-number }}
      image-name: ${{ steps.image-name.outputs.image-name }}
    steps:
      - name: Build
        id: build-step
        run: |
          echo "::set-output name=pr-number::$PR_NUMBER"
      - name: Checkout
        uses: actions/checkout@v2
      - name: Generate Image Name
        uses: ./.github/actions/ecr-registry
        id: image-name
        with:
          repository: asap-hub/node-python-sq
  build:
    needs: setup
    runs-on: ubuntu-latest
    env:
      PR_NUMBER: ${{ needs.setup.outputs.pr-number }}
    steps:
      - name: Start
        run: |
          echo "Started $PR_NUMBER"
