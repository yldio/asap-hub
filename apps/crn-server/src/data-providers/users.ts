import { UserDataObject } from '@asap-hub/model';
import { SquidexGraphqlClient } from '@asap-hub/squidex';
import {
  FetchUserQuery,
  FetchUserQueryVariables,
} from '../autogenerated-gql/graphql';
import { parseGraphQLUserToDataObject } from '../entities';
import { FETCH_USER } from '../queries/users.queries';

export interface UserDataProvider {
  fetchById(id: string): Promise<UserDataObject | null>;
}
export default function users(
  squidexGraphlClient: SquidexGraphqlClient,
): UserDataProvider {
  const fetchById = async (id: string) => {
    const { findUsersContent } = await squidexGraphlClient.request<
      FetchUserQuery,
      FetchUserQueryVariables
    >(FETCH_USER, { id });
    if (!findUsersContent) {
      return null;
    }
    return parseGraphQLUserToDataObject(findUsersContent);
  };

  return { fetchById };
}
