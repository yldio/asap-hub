import gql from 'graphql-tag';
import { FetchEventQuery } from '../autogenerated-gql/graphql';
import { groupContentQueryFragment } from './interest-groups.queries';
import { workingGroupContentQueryFragment } from './working-groups.queries';

export const eventContentFragment = gql`
  fragment EventContent on Events {
    id
    lastModified
    version
    created
    flatData {
      description
      endDate
      endDateTimeZone
      startDate
      startDateTimeZone
      meetingLink
      hideMeetingLink
      eventLink
      status
      hidden
      tags
      title
      notesPermanentlyUnavailable
      notes
      notesUpdatedAt
      videoRecordingPermanentlyUnavailable
      videoRecording
      videoRecordingUpdatedAt
      presentationPermanentlyUnavailable
      presentation
      presentationUpdatedAt
      meetingMaterialsPermanentlyUnavailable
      meetingMaterials {
        url
        title
      }
      calendar {
        flatData {
          googleCalendarId
          color
          name
        }
        referencingGroupsContents {
          ...GroupsContent
        }
        referencingWorkingGroupsContents {
          ...WorkingGroupContent
        }
      }
      thumbnail {
        id
      }
      speakers {
        team {
          id
          flatData {
            displayName
            inactiveSince
          }
        }
        user {
          __typename
          ... on Users {
            id
            flatData {
              alumniSinceDate
              alumniLocation
              firstName
              lastName
              onboarded
              avatar {
                id
              }
              teams {
                role
                id {
                  id
                }
              }
            }
          }
          ... on ExternalAuthors {
            id
            flatData {
              name
              orcid
            }
          }
        }
      }
    }
  }
  ${groupContentQueryFragment},
  ${workingGroupContentQueryFragment}
`;

export const FETCH_EVENTS = gql`
  query FetchEvents($top: Int, $skip: Int, $filter: String, $order: String) {
    queryEventsContentsWithTotal(
      top: $top
      skip: $skip
      filter: $filter
      orderby: $order
    ) {
      total
      items {
        ...EventContent
      }
    }
  }
  ${eventContentFragment}
`;

export const FETCH_EVENT = gql`
  query FetchEvent($id: String!) {
    findEventsContent(id: $id) {
      ...EventContent
    }
  }
  ${eventContentFragment}
`;

export const FETCH_GROUP_CALENDAR = gql`
  query FetchGroupCalendar($id: String!) {
    findGroupsContent(id: $id) {
      flatData {
        calendars {
          id
        }
      }
    }
  }
`;

export const FETCH_WORKING_GROUP_CALENDAR = gql`
  query FetchWorkingGroupCalendar($id: String!) {
    findWorkingGroupsContent(id: $id) {
      flatData {
        calendars {
          id
        }
      }
    }
  }
`;

export type GraphqlEvent = NonNullable<
  NonNullable<FetchEventQuery>['findEventsContent']
>;
