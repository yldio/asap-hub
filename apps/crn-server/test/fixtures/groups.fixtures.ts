import {
  GroupDataObject,
  GroupResponse,
  ListGroupResponse,
} from '@asap-hub/model';
import { EventBridgeEvent } from 'aws-lambda';
import {
  FetchGroupQuery,
  FetchGroupsQuery,
} from '../../src/autogenerated-gql/graphql';
import { appName, baseUrl } from '../../src/config';
import { GroupEvent, GroupPayload } from '../../src/handlers/event-bus';
import { createEventBridgeEventMock } from '../helpers/events';
import { getSquidexGraphqlTeam } from './teams.fixtures';
import { getGraphQLUser, getUserResponse } from './users.fixtures';

export const queryGroupsResponse = {
  data: {
    queryGroupsContentsWithTotal: {
      total: 2,
      items: [
        {
          id: 'group-id-1',
          created: '2020-12-11T14:33:50Z',
          lastModified: '2020-12-11T15:06:26Z',
          version: 42,
          flatData: {
            description: 'A test Group',
            name: "JT's Group",
            tags: ['coding'],
            thumbnail: [
              {
                id: 'uuid-thumbnail-1',
                created: '2020-12-11T14:33:50Z',
                lastModified: '2020-12-11T15:06:26Z',
                version: 42,
              },
            ],
            tools: [
              {
                slack: 'https://example.com/secure-comms',
              },
            ],
            calendars: [
              {
                id: 'calendar-id-1',
                created: '2020-12-11T14:33:50Z',
                lastModified: '2020-12-11T15:06:26Z',
                version: 42,
                flatData: {
                  color: '#B1365F',
                  googleCalendarId: 'hub@asap.science',
                  name: 'ASAP Hub',
                },
              },
            ],
            teams: [
              {
                __typename: 'Teams',
                id: 'team-id-1',
                created: '2020-12-11T14:33:50Z',
                lastModified: '2020-12-11T15:06:26Z',
                version: 42,
                flatData: {
                  applicationNumber: 'ASAP-000592',
                  displayName: 'Lee, M',
                  projectSummary: null,
                  projectTitle:
                    'Senescence in Parkinson’s disease and related disorders',
                  expertiseAndResourceTags: [],
                  proposal: [
                    {
                      id: 'output-id-1',
                    },
                  ],
                  tools: [
                    {
                      name: 'dropbox',
                      url: '  https://example.com/secure-comms',
                    },
                  ],
                },
              },
            ],
            leaders: [
              {
                role: 'Chair',
                user: [
                  {
                    id: 'user-id-1',
                    created: '2020-12-11T14:33:50Z',
                    lastModified: '2020-12-11T15:06:26Z',
                    version: 42,
                    flatData: {
                      avatar: [
                        {
                          id: 'asset-id-1',
                        },
                      ],
                      social: [
                        {
                          github: 'fampinheiro',
                          googleScholar: null,
                          linkedIn: 'fampinheiro',
                          researcherId: null,
                          researchGate: null,
                          twitter: 'fampinheiro',
                        },
                      ],
                      biography:
                        'Filipe is an Engineering Manager who works closely with our clients to ensure process and technical standards improvements. He previously worked at startups and multinational companies, leading tech projects in mobile and web apps, before bringing this gathered experience to YLD.',
                      degree: null,
                      email: 'filipe@yld.io',
                      firstName: 'Filipe',
                      institution: 'YLD',
                      jobTitle: 'Software Engineer',
                      lastModifiedDate: null,
                      lastName: 'Pinheiro',
                      orcid: null,
                      orcidLastModifiedDate: null,
                      orcidLastSyncDate: null,
                      orcidWorks: [],
                      labs: [
                        { id: 'cd7be4904', flatData: { name: 'Manchester' } },
                        { id: 'cd7be4905', flatData: { name: 'Glasgow' } },
                      ],
                      questions: [
                        {
                          question: 'What is the meaning of life?',
                        },
                        {
                          question: 'Question 2',
                        },
                      ],
                      expertiseAndResourceTags: ['React'],
                      expertiseAndResourceDescription:
                        "In addition to his expertise in not for profit management, Todd has scientific experience in animal models and the cell biology of Parkinson's disease.",
                      teams: [
                        {
                          role: 'Co-PI (Core Leadership)',
                          id: [
                            {
                              __typename: 'Teams',
                              id: 'team-id-2',
                              created: '2020-12-11T14:33:50Z',
                              lastModified: '2020-12-11T15:06:26Z',
                              version: 42,
                              flatData: {
                                displayName: 'Rio, D',
                                proposal: [],
                              },
                            },
                          ],
                        },
                      ],
                    },
                  },
                ],
              },
              {
                role: 'Project Manager',
                user: [
                  {
                    id: 'user-id-2',
                    created: '2020-12-11T14:33:50Z',
                    lastModified: '2020-12-11T15:06:26Z',
                    version: 42,
                    flatData: {
                      avatar: [],
                      social: [
                        {
                          github: 'johnytiago',
                          googleScholar: null,
                          linkedIn: null,
                          researcherId: null,
                          researchGate: null,
                          twitter: null,
                        },
                      ],
                      biography: null,
                      degree: null,
                      email: 'joao.tiago@yld.io',
                      firstName: 'João',
                      institution: 'YLD',
                      jobTitle: null,
                      lastModifiedDate: null,
                      lastName: 'Tiago',
                      orcid: null,
                      orcidLastModifiedDate: null,
                      orcidLastSyncDate: null,
                      orcidWorks: [],
                      questions: [],
                      expertiseAndResourceTags: [],
                      expertiseAndResourceDescription: null,
                      labs: [
                        { id: 'cd7be4902', flatData: { name: 'Barcelona' } },
                        { id: 'cd7be4905', flatData: { name: 'Glasgow' } },
                      ],
                      teams: [],
                    },
                  },
                ],
              },
            ],
          },
        },
        {
          id: 'group-id-2',
          created: '2020-12-11T14:33:50Z',
          lastModified: '2020-12-11T15:06:26Z',
          version: 42,
          flatData: {
            description: 'A test Group',
            name: "FP's Group",
            tags: ['coding'],
            thumbnail: [],
            tools: [
              {
                slack: 'https://example.com/secure-comms',
              },
            ],
            calendars: [
              {
                id: 'calendar-id-1',
                created: '2020-12-11T14:33:50Z',
                lastModified: '2020-12-11T15:06:26Z',
                version: 42,
                flatData: {
                  color: '#B1365F',
                  googleCalendarId: 'hub@asap.science',
                  name: 'ASAP Hub',
                },
              },
            ],
            teams: [],
            leaders: [],
          },
        },
      ],
    },
  },
};

export const listGroupsResponse: ListGroupResponse = {
  total: 2,
  items: [
    {
      id: 'group-id-1',
      active: true,
      createdDate: '2020-12-11T14:33:50.000Z',
      lastModifiedDate: '2020-12-11T15:06:26.000Z',
      name: "JT's Group",
      tags: ['coding'],
      thumbnail: `${baseUrl}/api/assets/${appName}/uuid-thumbnail-1`,
      description: 'A test Group',
      tools: {
        slack: 'https://example.com/secure-comms',
        googleCalendar:
          'https://calendar.google.com/calendar/r?cid=calendar-id-1',
      },
      teams: [
        {
          id: 'team-id-1',
          displayName: 'Lee, M',
          lastModifiedDate: '2020-12-11T15:06:26.000Z',
          expertiseAndResourceTags: [],
          projectTitle:
            'Senescence in Parkinson’s disease and related disorders',
          proposalURL: 'output-id-1',
          tools: [
            {
              name: 'dropbox',
              url: '  https://example.com/secure-comms',
            },
          ],
        },
      ],
      leaders: [
        {
          user: {
            id: 'user-id-1',
            onboarded: true,
            createdDate: '2020-12-11T14:33:50.000Z',
            displayName: 'Filipe Pinheiro',
            firstName: 'Filipe',
            lastName: 'Pinheiro',
            biography:
              'Filipe is an Engineering Manager who works closely with our clients to ensure process and technical standards improvements. He previously worked at startups and multinational companies, leading tech projects in mobile and web apps, before bringing this gathered experience to YLD.',
            email: 'filipe@yld.io',
            institution: 'YLD',
            jobTitle: 'Software Engineer',
            orcidWorks: [],
            questions: ['What is the meaning of life?', 'Question 2'],
            expertiseAndResourceTags: ['React'],
            expertiseAndResourceDescription:
              "In addition to his expertise in not for profit management, Todd has scientific experience in animal models and the cell biology of Parkinson's disease.",
            lastModifiedDate: '2020-12-11T14:33:50.000Z',
            teams: [
              {
                id: 'team-id-2',
                role: 'Co-PI (Core Leadership)',
                displayName: 'Rio, D',
              },
            ],
            social: {
              github: 'fampinheiro',
              linkedIn: 'fampinheiro',
              twitter: 'fampinheiro',
            },
            avatarUrl: `${baseUrl}/api/assets/${appName}/asset-id-1`,
            role: 'Guest',
            labs: [
              { id: 'cd7be4904', name: 'Manchester' },
              { id: 'cd7be4905', name: 'Glasgow' },
            ],
          },
          role: 'Chair',
        },
        {
          user: {
            id: 'user-id-2',
            onboarded: true,
            createdDate: '2020-12-11T14:33:50.000Z',
            displayName: 'João Tiago',
            firstName: 'João',
            lastName: 'Tiago',
            email: 'joao.tiago@yld.io',
            institution: 'YLD',
            orcidWorks: [],
            questions: [],
            expertiseAndResourceTags: [],
            lastModifiedDate: '2020-12-11T14:33:50.000Z',
            teams: [],
            social: { github: 'johnytiago' },
            role: 'Guest',
            labs: [
              { id: 'cd7be4902', name: 'Barcelona' },
              { id: 'cd7be4905', name: 'Glasgow' },
            ],
          },
          role: 'Project Manager',
        },
      ],
      calendars: [
        { id: 'hub@asap.science', color: '#B1365F', name: 'ASAP Hub' },
      ],
    },
    {
      id: 'group-id-2',
      active: true,
      createdDate: '2020-12-11T14:33:50.000Z',
      lastModifiedDate: '2020-12-11T15:06:26.000Z',
      name: "FP's Group",
      tags: ['coding'],
      description: 'A test Group',
      tools: {
        slack: 'https://example.com/secure-comms',
        googleCalendar:
          'https://calendar.google.com/calendar/r?cid=calendar-id-1',
      },
      teams: [],
      leaders: [],
      calendars: [
        { id: 'hub@asap.science', color: '#B1365F', name: 'ASAP Hub' },
      ],
    },
  ],
};

export const getSquidexGraphqlGroup = (): NonNullable<
  FetchGroupQuery['findGroupsContent']
> => ({
  id: 'group-id-1',
  created: '2020-12-11T14:33:50Z',
  lastModified: '2020-12-11T15:06:26Z',
  version: 42,
  flatData: {
    active: true,
    description: 'A test Group',
    name: "JT's Group",
    tags: ['coding'],
    thumbnail: [
      {
        id: 'uuid-thumbnail-1',
      },
    ],
    tools: [
      {
        slack: 'https://example.com/secure-comms',
        googleDrive: null,
      },
    ],
    calendars: [
      {
        id: 'calendar-id-1',
        flatData: {
          color: '#B1365F',
          googleCalendarId: 'hub@asap.science',
          name: 'ASAP Hub',
        },
      },
    ],
    teams: [getSquidexGraphqlTeam({})],
    leaders: [
      {
        role: 'Chair',
        user: [getGraphQLUser()],
      },
      {
        role: 'Project Manager',
        user: [getGraphQLUser()],
      },
    ],
  },
});

export const getSquidexGroupsGraphqlResponse = (): FetchGroupsQuery => ({
  queryGroupsContentsWithTotal: {
    total: 1,
    items: [getSquidexGraphqlGroup()],
  },
});

export const getSquidexGroupGraphqlResponse = (): FetchGroupQuery => ({
  findGroupsContent: getSquidexGraphqlGroup(),
});

export const getGroupResponse = (): GroupResponse => getGroupDataObject();

export const getListGroupResponse = (): ListGroupResponse => ({
  total: 1,
  items: [getGroupResponse()],
});

export const getGroupPayload = (
  id: string,
  type: GroupEvent,
): GroupPayload => ({
  type,
  payload: {
    $type: 'EnrichedContentEvent',
    type: 'Updated',
    id,
  },
});

export const getGroupEvent = (
  id: string,
  eventType: GroupEvent,
): EventBridgeEvent<GroupEvent, GroupPayload> =>
  createEventBridgeEventMock(getGroupPayload(id, eventType), eventType, id);

export const getGroupDataObject = (): GroupDataObject => ({
  id: 'group-id-1',
  active: true,
  createdDate: '2020-12-11T14:33:50.000Z',
  lastModifiedDate: '2020-12-11T15:06:26.000Z',
  name: "JT's Group",
  tags: ['coding'],
  thumbnail: `${baseUrl}/api/assets/${appName}/uuid-thumbnail-1`,
  description: 'A test Group',
  tools: {
    slack: 'https://example.com/secure-comms',
    googleCalendar: 'https://calendar.google.com/calendar/r?cid=calendar-id-1',
  },
  teams: [
    {
      id: 'team-id-1',
      displayName: 'Team A',
      lastModifiedDate: '2020-11-26T11:56:04.000Z',
      expertiseAndResourceTags: ['Animal resources'],

      projectTitle:
        'The genome-microbiome axis in the cause of Parkinson disease: Mechanistic insights and therapeutic implications from experimental models and a genetically stratified patient population.',
      proposalURL: '4cfb1b7b-bafe-4fca-b2ab-197e84d98996',
      tools: [],
      outputs: [],
    },
  ],
  leaders: [
    {
      user: getUserResponse(),
      role: 'Chair',
    },
    {
      user: getUserResponse(),
      role: 'Project Manager',
    },
  ],
  calendars: [{ id: 'hub@asap.science', color: '#B1365F', name: 'ASAP Hub' }],
});
