import { gp2 as gp2Contentful } from '@asap-hub/contentful';
import { EventStatus, gp2 as gp2Model } from '@asap-hub/model';
import { Event, RestEvent } from '@asap-hub/squidex';
import {
  EventDataFragment,
  FetchEventQuery,
  FetchEventsQuery,
} from '../../src/autogenerated-gql/graphql';
import { appName, baseUrl } from '../../src/config';
import { getGraphQLProject } from './project.fixtures';
import { getGraphQLWorkingGroup } from './working-group.fixtures';

export const getContentfulGraphql = () => ({
  Events: () => getContentfulGraphqlEvent(),
  ProjectsCollection: () => getContentfulProjectsCollection(),
  WorkingGroupsCollection: () => getContentfulWorkingGroupsCollection(),
});

export const getContentfulGraphqlEvent = (): NonNullable<
  NonNullable<
    gp2Contentful.FetchEventsQuery['eventsCollection']
  >['items'][number]
> => ({
  sys: {
    id: 'ec3086d4-aa64-4f30-a0f7-5c5b95ffbcca',
    publishedAt: '2021-05-14T14:48:46.000Z',
  },
  description: 'This event is awesome',
  endDate: '2009-12-24T16:30:54.000Z',
  endDateTimeZone: 'UTC',
  startDate: '2009-12-24T16:20:14.000Z',
  startDateTimeZone: 'UTC',
  meetingLink: 'https://zoom.com/room/123',
  hideMeetingLink: false,
  eventLink: 'https://zoom.com/room/123',
  status: 'Confirmed',
  hidden: false,
  tags: [],
  title: 'Example Event',
  notesPermanentlyUnavailable: false,
  notes: {
    json: {
      data: {},
      content: [
        {
          data: {},
          content: [
            {
              data: {},
              marks: [],
              value: 'These are the notes from the meeting',
              nodeType: 'text',
            },
          ],
          nodeType: 'paragraph',
        },
      ],
      nodeType: 'document',
    },
    links: {
      entries: {
        inline: [],
      },
      assets: {
        block: [],
      },
    },
  },
  notesUpdatedAt: '2010-10-01T08:00:04.000Z',
  videoRecordingPermanentlyUnavailable: false,
  videoRecording: {
    json: {
      nodeType: 'document',
      data: {},
      content: [
        {
          nodeType: 'paragraph',
          data: {},
          content: [
            {
              nodeType: 'text',
              value: '',
              marks: [],
              data: {},
            },
            {
              nodeType: 'embedded-entry-inline',
              data: {
                target: {
                  sys: {
                    id: 'video-id',
                    type: 'Link',
                    linkType: 'Entry',
                  },
                },
              },
              content: [],
            },
            {
              nodeType: 'text',
              value: '',
              marks: [],
              data: {},
            },
          ],
        },
      ],
    },
    links: {
      entries: {
        inline: [
          {
            sys: {
              id: 'video-id',
            },
            __typename: 'Media',
            url: 'https://player.vimeo.com/video/493052720',
          },
        ],
      },
      assets: {
        block: [],
      },
    },
  },
  videoRecordingUpdatedAt: '2010-08-01T08:00:04.000Z',
  presentationPermanentlyUnavailable: false,
  presentation: {
    json: {
      nodeType: 'document',
      data: {},
      content: [
        {
          nodeType: 'paragraph',
          data: {},
          content: [
            {
              nodeType: 'text',
              value: '',
              marks: [],
              data: {},
            },
            {
              nodeType: 'embedded-entry-inline',
              data: {
                target: {
                  sys: {
                    id: 'presentation-id',
                    type: 'Link',
                    linkType: 'Entry',
                  },
                },
              },
              content: [],
            },
            {
              nodeType: 'text',
              value: '',
              marks: [],
              data: {},
            },
          ],
        },
      ],
    },
    links: {
      entries: {
        inline: [
          {
            sys: {
              id: 'presentation-id',
            },
            __typename: 'Media',
            url: 'https://example.com',
          },
        ],
      },
      assets: {
        block: [],
      },
    },
  },
  presentationUpdatedAt: '2010-09-01T08:00:04.000Z',
  meetingMaterialsPermanentlyUnavailable: false,
  meetingMaterials: [
    {
      title: 'My additional link',
      url: 'https://link.pt/additional-material',
    },
  ],
  calendar: {
    googleCalendarId: 'c_t92qa82jd702q1fkreoi0hf4hk@group.calendar.google.com',
    color: '#125A12' as const,
    name: 'Tech 1 - Sequencing/omics',
    linkedFrom: {
      projectsCollection: {
        items: getContentfulProjectsCollection().items,
      },
      workingGroupsCollection: {
        items: getContentfulWorkingGroupsCollection().items,
      },
    },
  },
  thumbnail: {
    url: 'https://example.com',
  },
  speakersCollection: {
    items: [
      {
        title: 'Some Topic',
        user: {
          __typename: 'Users',
          sys: {
            id: 'user-id-3',
          },
          firstName: 'Adam',
          lastName: 'Brown',
          onboarded: true,
          avatar: null,
        },
      },
    ],
  },
});

export const getContentfulProjectsCollection = () => ({
  total: 1,
  items: [
    {
      sys: { id: '7' },
      title: 'a project title',
    },
  ],
});

export const getContentfulWorkingGroupsCollection = () => ({
  total: 1,
  items: [
    {
      sys: { id: '11' },
      title: 'a working group title',
    },
  ],
});

export const getContentfulGraphqlEventsResponse =
  (): gp2Contentful.FetchEventsQuery => ({
    eventsCollection: {
      total: 1,
      items: [getContentfulGraphqlEvent()],
    },
  });

export const getEventsByUserIdGraphqlResponse =
  (): gp2Contentful.FetchEventsByUserIdQuery => ({
    users: {
      linkedFrom: {
        eventSpeakersCollection: {
          items: [
            {
              linkedFrom: {
                eventsCollection: {
                  total: 1,
                  items: [getContentfulGraphqlEvent()],
                },
              },
            },
          ],
        },
      },
    },
  });

export const getEventsByExternalUserIdGraphqlResponse =
  (): gp2Contentful.FetchEventsByExternalUserIdQuery => ({
    externalUsers: {
      linkedFrom: {
        eventSpeakersCollection: {
          items: [
            {
              linkedFrom: {
                eventsCollection: {
                  total: 1,
                  items: [getContentfulGraphqlEvent()],
                },
              },
            },
          ],
        },
      },
    },
  });

export const getEventRestResponse = (): Event => ({
  googleId: 'google-event-id',
  title: 'Event Tittle',
  description: 'This event will be good',
  startDate: '2021-02-23T19:32:00Z',
  startDateTimeZone: 'Europe/Lisbon',
  endDate: '2021-02-23T19:32:00Z',
  endDateTimeZone: 'Europe/Lisbon',
  calendar: ['squidex-calendar-id'],
  status: 'Confirmed' as EventStatus,
  tags: [],
  hidden: false,
  meetingLink: 'https://zweem.com',
  hideMeetingLink: false,
});

export const getEventSpeakerUser = (): gp2Model.EventSpeakerUser => ({
  id: 'user-id-3',
  firstName: 'Adam',
  lastName: 'Brown',
  displayName: 'Adam Brown',
  avatarUrl: undefined,
});

export const getContentfulEventDataObject = (): gp2Model.EventDataObject => ({
  ...getEventDataObject(),
  notes: '<p>These are the notes from the meeting</p>',
  presentation: '<p><iframe src="https://example.com"/></p>',
  videoRecording:
    '<p><iframe src="https://player.vimeo.com/video/493052720"/></p>',
  thumbnail: 'https://example.com',
  calendar: {
    ...getEventDataObject().calendar,
    projects: [
      {
        id: '7',
        title: 'a project title',
      },
    ],
    workingGroups: [
      {
        id: '11',
        title: 'a working group title',
      },
    ],
  },
});

export const getContentfulEventResponse = (): gp2Model.EventResponse =>
  getEventDataObject();

export const getContentfulListEventDataObject =
  (): gp2Model.ListEventDataObject => ({
    total: 1,
    items: [getContentfulEventDataObject()],
  });

export const getContentfulListEventResponse = (): gp2Model.ListEventResponse =>
  getContentfulListEventDataObject();

export const getEventSpeaker = (): gp2Model.EventSpeaker => ({
  speaker: getEventSpeakerUser(),
  topic: 'Some Topic',
});

export const getEventExternalUser = (): gp2Model.EventSpeakerExternalUser => ({
  name: 'Adam Brown',
  orcid: '1234-1234-1234',
});

export const getEventExternalSpeaker = (): gp2Model.EventSpeaker => ({
  speaker: getEventExternalUser(),
  topic: 'Some Topic',
});

export const getEventSpeakerToBeAnnounced = (): gp2Model.EventSpeaker => ({
  speaker: undefined,
  topic: undefined,
});

export const getEventDataObject = (): gp2Model.EventDataObject => ({
  id: 'ec3086d4-aa64-4f30-a0f7-5c5b95ffbcca',
  description: 'This event is awesome',
  lastModifiedDate: '2021-05-14T14:48:46.000Z',
  endDate: '2009-12-24T16:30:54.000Z',
  endDateTimestamp: 1261672254,
  startDate: '2009-12-24T16:20:14.000Z',
  startDateTimestamp: 1261671614,
  meetingLink: 'https://zoom.com/room/123',
  hideMeetingLink: false,
  status: 'Confirmed',
  tags: [],
  title: 'Example Event',
  startDateTimeZone: 'UTC',
  endDateTimeZone: 'UTC',
  notes: 'These are the notes from the meeting',
  videoRecording: '<embeded>video</embeded>',
  presentation: '<embeded>presentation</embeded>',
  meetingMaterials: [
    {
      title: 'My additional link',
      url: 'https://link.pt/additional-material',
    },
  ],
  thumbnail: `${baseUrl}/api/assets/${appName}/uuid-thumbnail-2`,
  calendar: {
    color: '#125A12',
    id: 'c_t92qa82jd702q1fkreoi0hf4hk@group.calendar.google.com',
    name: 'Tech 1 - Sequencing/omics',
    projects: [],
    workingGroups: [],
  },
  speakers: [getEventSpeaker()],
  workingGroup: { id: '11', title: 'a working group title' },
  project: { id: '7', title: 'a project title' },
});

export const getListEventDataObject = (): gp2Model.ListEventDataObject => ({
  total: 1,
  items: [getEventDataObject()],
});
export const getEventResponse = (): gp2Model.EventResponse =>
  getEventDataObject();
export const getListEventResponse = (): gp2Model.ListEventResponse =>
  getListEventDataObject();

export const getRestEvent = (): RestEvent => ({
  id: 'squidex-event-id',
  created: '2021-02-23T19:32:00Z',
  lastModified: '2021-02-23T19:32:00Z',
  version: 42,
  data: getEventInput(),
});

export const getEventInput = () => ({
  googleId: { iv: 'google-event-id' },
  title: { iv: 'Event Tittle' },
  description: { iv: 'This event will be good' },
  startDate: { iv: '2021-02-23T19:32:00Z' },
  startDateTimeZone: { iv: 'Europe/Lisbon' },
  endDate: { iv: '2021-02-23T19:32:00Z' },
  endDateTimeZone: { iv: 'Europe/Lisbon' },
  calendar: { iv: ['squidex-calendar-id'] },
  status: { iv: 'Confirmed' as EventStatus },
  tags: { iv: [] },
  hidden: { iv: false },
  meetingLink: { iv: 'https://zweem.com' },
  hideMeetingLink: { iv: false },
});

export const getEventCreateDataObject = (): gp2Model.EventCreateDataObject => ({
  googleId: 'google-event-id',
  title: 'Event Tittle',
  description: 'This event will be good',
  startDate: '2021-02-23T19:32:00Z',
  startDateTimeZone: 'Europe/Lisbon',
  endDate: '2021-02-23T19:32:00Z',
  endDateTimeZone: 'Europe/Lisbon',
  calendar: 'squidex-calendar-id',
  status: 'Confirmed' as EventStatus,
  tags: [],
  hidden: false,
  meetingLink: 'https://zweem.com',
  hideMeetingLink: false,
});

export const getSquidexGraphqlEvent = () => ({
  id: 'ec3086d4-aa64-4f30-a0f7-5c5b95ffbcca',
  created: '2020-09-23T16:34:26.842Z',
  lastModified: '2021-05-14T14:48:46Z',
  version: 43,
  flatData: squidexGraphqlEventsFlatData(),
});
type EventSpeakers = NonNullable<
  NonNullable<EventDataFragment['flatData']['speakers']>[number]
>;

type EventSpeakerUser = NonNullable<EventSpeakers['user']>[number]['flatData'];
export const getSquidexGraphqlEventSpeakerWithUser = (
  overrides: Partial<EventSpeakerUser> = {},
): EventSpeakers => ({
  user: [
    {
      __typename: 'Users',
      id: 'user-id-3',
      flatData: {
        avatar: [],
        firstName: 'Adam',
        lastName: 'Brown',
        onboarded: true,
        ...overrides,
      },
    },
  ],
  topic: 'Some Topic',
});

type EventSpeakerExternalUser = NonNullable<
  EventSpeakers['user']
>[number]['flatData'];
export const getSquidexGraphqlEventSpeakerWithExternalUser = (
  overrides: Partial<EventSpeakerExternalUser> = {},
): EventSpeakers => ({
  user: [
    {
      __typename: 'ExternalUsers',
      id: 'user-id-3',
      flatData: {
        name: 'Adam Brown',
        orcid: '1234-1234-1234',
        ...overrides,
      },
    },
  ],
  topic: 'Some Topic',
});

const squidexGraphqlEventsFlatData = (): EventDataFragment['flatData'] & {
  videoRecordingUpdatedAt: string;
  presentationUpdatedAt: string;
  notesUpdatedAt: string;
} => ({
  description: 'This event is awesome',
  endDate: '2009-12-24T16:30:54.000Z',
  startDate: '2009-12-24T16:20:14.000Z',
  videoRecordingUpdatedAt: '2010-08-01T08:00:04.000Z',
  presentationUpdatedAt: '2010-09-01T08:00:04.000Z',
  notesUpdatedAt: '2010-10-01T08:00:04.000Z',
  meetingLink: 'https://zoom.com/room/123',
  hideMeetingLink: false,
  status: 'Confirmed',
  tags: [],
  title: 'Example Event',
  startDateTimeZone: 'UTC',
  endDateTimeZone: 'UTC',
  notesPermanentlyUnavailable: false,
  notes: 'These are the notes from the meeting',
  videoRecordingPermanentlyUnavailable: false,
  videoRecording: '<embeded>video</embeded>',
  presentationPermanentlyUnavailable: false,
  presentation: '<embeded>presentation</embeded>',
  meetingMaterialsPermanentlyUnavailable: false,
  meetingMaterials: [
    {
      title: 'My additional link',
      url: 'https://link.pt/additional-material',
    },
  ],
  thumbnail: [
    {
      id: 'uuid-thumbnail-2',
    },
  ],
  eventLink: 'https://zoom.com/room/123',
  calendar: [
    {
      flatData: {
        googleCalendarId:
          'c_t92qa82jd702q1fkreoi0hf4hk@group.calendar.google.com',
        color: '#125A12' as const,
        name: 'Tech 1 - Sequencing/omics',
      },
      referencingProjectsContents: [getGraphQLProject()],
      referencingWorkingGroupsContents: [getGraphQLWorkingGroup()],
    },
  ],
  speakers: [getSquidexGraphqlEventSpeakerWithUser()],
});

export const getSquidexGraphqlEvents = (): gp2Model.ListEventResponse => ({
  items: [getEventResponse()],
  total: 1,
});
export const squidexGraphqlEventResponse = () => ({
  description: 'This event is awesome',
  meetingLink: 'https://zoom.com/room/123',
  endDate: '2009-12-24T16:30:54.000Z',
  startDate: '2009-12-24T16:20:14.000Z',
  status: 'Confirmed',
  tags: [],
  title: 'Example Event',
  calendar: {
    color: '#125A12',
    name: 'Tech 1 - Sequencing/omics',
    id: 'c_t92qa82jd702q1fkreoi0hf4hk@group.calendar.google.com',
  },
});

export const getSquidexEventsGraphqlResponse = (): FetchEventsQuery => ({
  queryEventsContentsWithTotal: {
    items: [getSquidexGraphqlEvent()],
    total: 1,
  },
});

export const getSquidexEventGraphqlResponse = (): FetchEventQuery => ({
  findEventsContent: getSquidexGraphqlEvent(),
});
