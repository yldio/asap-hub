# Algolia frontend integration

Status: Draft
Date: 2021-06-11
Author: Thomas Waterfall <tom.waterfall@yld.io>

## Context

Algolia is a hosted search engine, offering full-text, numerical, and faceted search, capable of delivering real-time results from the first keystroke. With this spike, we intend to validate how an Algolia integration may work for us.
https://trello.com/c/psooQwik/1360-spike-algolia-search-for-fe

## Questions

### What's the setup, what's the config stored in the CI (API keys etc)?

To search you need an App ID and Search Key or Secured Search Key.
The development app ID can be stored for the frontend in apps/frontend/src/config.ts and overwritten on the CI like we do for other configuration variables eg REACT_APP_API_BASE_URL
The generic search key doesn't expire and thus unsuitable for production use. We should use a Secured Search Key with TTL generated by the backend to secure the search.

### Which library to use (JS lib/React components)

We could use the React specific implementation using the "hybrid" approach however we would need to support functionality we don't need or leave components half implemented. It would also make us more tightly coupled to Algolia making it more difficult to change search engine should it be required in the future.
I think it would be easier to use the vanilla js approach keeping the API interface minimal.

### Authorisation, how to block the search from the public?

Auth is done by a secured search key and setting visibility options when items are indexed. The secured search key has to be generated server side with a TTL.

### How token refresh works and whether it is feasible to put it in the ID token?

Secured API keys always derive from one of your main API keys. When requesting a secured key you can set the validity window. This should be done on a separate backend endpoint.
We could set this window to match the Auth0 TTL to leverage the existing Auth0 token refresh mechanism and logout to revoke secured keys in the future . If this is done as a single API request we can keep this mostly decoupled from Auth0.
