import { Environment, SysLink } from 'contentful-management';
import { Asset, Maybe } from '../autogenerated-gql/graphql';
import { migrateAsset } from '../assets/assets.data-migration';

export const createAssetLink = async (
  contentfulEnvironment: Environment,
  asset: Maybe<
    Pick<Asset, 'id' | 'fileName' | 'thumbnailUrl' | 'mimeType' | 'fileType'>[]
  >,
): Promise<SysLink | null> => {
  if (asset?.length) {
    await migrateAsset(contentfulEnvironment, asset);
    return {
      sys: {
        type: 'Link',
        linkType: 'Asset',
        // in thumbnail it's possible to load only one asset
        id: asset[0]?.id,
      },
    };
  }
  return null;
};
