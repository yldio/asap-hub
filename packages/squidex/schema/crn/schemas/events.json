{
  "$schema": "./../__json/schema.json",
  "schema": {
    "noFieldDeletion": false,
    "noFieldRecreation": false,
    "properties": {
      "label": "Events",
      "validateOnPublish": false
    },
    "scripts": {
      "create": "const teamsSpeakersSet = new Set();\n\nif (\n    ctx.data.speakers\n    && ctx.data.speakers.iv\n) {\n    for (const speaker of ctx.data.speakers.iv) {\n        if (!speaker.team && !speaker.user) {\n            return reject('You must select team or user or both for speakar');\n        }\n        \n        if (\n            speaker.team.length === 1\n            && speaker.user.length === 1\n        ) {\n            const teamSpeaker = `${speaker.team[0]}-${speaker.user[0]}`;\n            if (teamsSpeakersSet.has(teamSpeaker)) {\n                return reject('Duplicates with same team and speaker are not allowed');\n            }\n            \n            teamsSpeakersSet.add(teamSpeaker);\n            \n            getReference(speaker.user[0], function (users) {\n              if (users && users.length === 1 && users[0].SchemaId.name === 'external-authors') {\n                  return reject('Selecting team for speaker is not allowed when user is external author');\n              }\n            });\n        }     \n    }\n}\n\nif (ctx.data.videoRecording.iv) {\n    ctx.data.videoRecordingUpdatedAt.iv = new Date().toISOString(),\n    replace();\n}\n",
      "update": "const teamsSpeakersSet = new Set();\n\nif (\n    ctx.data.speakers\n    && ctx.data.speakers.iv\n) {\n    for (const speaker of ctx.data.speakers.iv) {\n        if (!speaker.team && !speaker.user) {\n            return reject('You must select team or user or both for speaker');\n        }\n        \n        if (\n            speaker.team.length === 1\n            && speaker.user.length === 1\n        ) {\n            const teamSpeaker = `${speaker.team[0]}-${speaker.user[0]}`;\n            if (teamsSpeakersSet.has(teamSpeaker)) {\n                return reject('Duplicates with same team and speaker are not allowed');\n            }\n            \n            teamsSpeakersSet.add(teamSpeaker);\n            \n            getReference(speaker.user[0], function (users) {\n              if (users && users.length === 1 && users[0].SchemaId.name === 'external-authors') {\n                  return reject('Selecting team for speaker is not allowed when user is external author');\n              }\n            });\n        }     \n    }\n}\n\nconst videoRecordingChanged = ctx.data.videoRecording.iv !== ctx.oldData.videoRecording.iv\n\nif (videoRecordingChanged) {\n    if (!!ctx.data.videoRecording.iv) {\n        ctx.data.videoRecordingUpdatedAt.iv = new Date().toISOString()   \n    } else {\n        ctx.data.videoRecordingUpdatedAt.iv = \"\"\n    }\n}\n\nconst presentationChanged = ctx.data.presentation.iv !== ctx.oldData.presentation.iv\n\nif (presentationChanged) {\n    if (!!ctx.data.presentation.iv) {\n        ctx.data.presentationUpdatedAt.iv = new Date().toISOString()\n    } else {\n        ctx.data.presentationUpdatedAt.iv = \"\"\n    }\n}\n\nconst notesChanged = ctx.data.notes.iv !== ctx.oldData.notes.iv\n\nif (notesChanged) {\n    if (!!ctx.data.notes.iv) {\n        ctx.data.notesUpdatedAt.iv = new Date().toISOString()\n    } else {\n        ctx.data.notesUpdatedAt.iv = \"\"\n    }\n}\n\nif (videoRecordingChanged || presentationChanged || notesChanged) {\n    replace();\n}\n"
    },
    "fieldsInReferences": ["title", "startDate"],
    "fieldsInLists": [
      "meta.status.color",
      "title",
      "startDate",
      "calendar",
      "status",
      "hidden",
      "meetingLink",
      "hideMeetingLink",
      "tags",
      "notesPermanentlyUnavailable",
      "notes",
      "videoRecordingPermanentlyUnavailable",
      "videoRecording",
      "presentationPermanentlyUnavailable",
      "presentation",
      "meetingMaterialsPermanentlyUnavailable",
      "meetingMaterials",
      "description",
      "thumbnail",
      "endDate",
      "googleId",
      "eventLink",
      "meta.id",
      "meta.created",
      "meta.createdBy.avatar",
      "meta.lastModified",
      "meta.lastModifiedBy.avatar"
    ],
    "fields": [
      {
        "name": "title",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": true,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "String",
          "isUnique": false,
          "isEmbeddable": false,
          "inlineEditable": false,
          "createEnum": false,
          "contentType": "Unspecified",
          "editor": "Input",
          "label": "Title",
          "hints": "",
          "placeholder": "",
          "isRequired": true,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "startDate",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": true,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "DateTime",
          "editor": "DateTime",
          "label": "Start Date",
          "hints": "",
          "placeholder": "",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": true
        }
      },
      {
        "name": "status",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": true,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "String",
          "allowedValues": ["Confirmed", "Tentative", "Cancelled"],
          "isUnique": false,
          "isEmbeddable": false,
          "inlineEditable": false,
          "createEnum": false,
          "contentType": "Unspecified",
          "editor": "Dropdown",
          "label": "Status",
          "hints": "",
          "placeholder": "",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": true
        }
      },
      {
        "name": "calendar",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": true,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "References",
          "minItems": 1,
          "maxItems": 1,
          "allowDuplicates": false,
          "resolveReference": true,
          "mustBePublished": false,
          "editor": "Dropdown",
          "schemaIds": ["calendars"],
          "label": "Calendar",
          "isRequired": true,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "hidden",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "Boolean",
          "defaultValue": false,
          "inlineEditable": true,
          "editor": "Checkbox",
          "label": "Hide Event",
          "hints": "Hidden events will NOT show on the Hub. (Note: any event cancelled on GCal will be hidden by default. To show a cancelled event on the Hub, you have to manually un-hide the event here)",
          "placeholder": "",
          "isRequired": true,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "separatorFutureEventsData",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "UI",
          "editor": "Separator",
          "label": "Future Events Data",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "meetingLink",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "String",
          "pattern": "^(?:http(s)?:\\/\\/)[\\w.-]+(?:\\.[\\w\\.-]+)+[\\w\\-\\._~:\\/?#%[\\]@!\\$&'\\(\\)\\*\\+,;=.]+$",
          "patternMessage": "URL must start with http:// or https://",
          "isUnique": false,
          "isEmbeddable": false,
          "inlineEditable": true,
          "createEnum": false,
          "contentType": "Unspecified",
          "editor": "Input",
          "label": "Meeting Link",
          "hints": "",
          "placeholder": "",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": true
        }
      },
      {
        "name": "hideMeetingLink",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "Boolean",
          "defaultValue": false,
          "inlineEditable": true,
          "editor": "Checkbox",
          "label": "Hide Meeting Link",
          "isRequired": true,
          "isRequiredOnPublish": false,
          "isHalfWidth": true
        }
      },
      {
        "name": "thumbnail",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "Assets",
          "previewMode": "Image",
          "maxItems": 1,
          "resolveFirst": true,
          "mustBeImage": false,
          "resolveImage": true,
          "allowDuplicates": false,
          "label": "Thumbnail",
          "hints": "",
          "placeholder": "",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": true
        }
      },
      {
        "name": "tags",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "Tags",
          "createEnum": false,
          "editor": "Tags",
          "label": "Tags",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": true
        }
      },
      {
        "name": "separatorSpeakers",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "UI",
          "editor": "Separator",
          "label": "Speakers",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "speakers",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "Array",
          "maxItems": 20,
          "label": "Speakers",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        },
        "nested": [
          {
            "name": "team",
            "isHidden": false,
            "isLocked": false,
            "isDisabled": false,
            "properties": {
              "fieldType": "References",
              "minItems": 1,
              "maxItems": 1,
              "allowDuplicates": false,
              "resolveReference": false,
              "mustBePublished": false,
              "editor": "List",
              "schemaIds": ["teams"],
              "label": "Team",
              "isRequired": false,
              "isRequiredOnPublish": false,
              "isHalfWidth": false
            }
          },
          {
            "name": "user",
            "isHidden": false,
            "isLocked": false,
            "isDisabled": false,
            "properties": {
              "fieldType": "References",
              "maxItems": 1,
              "allowDuplicates": false,
              "resolveReference": false,
              "mustBePublished": false,
              "editor": "List",
              "schemaIds": ["users", "external-authors"],
              "label": "User",
              "isRequired": false,
              "isRequiredOnPublish": false,
              "isHalfWidth": false
            }
          }
        ]
      },
      {
        "name": "separatorMeetingMaterials",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "UI",
          "editor": "Separator",
          "label": "Meeting Materials",
          "hints": "This will only show for past events - if you add upfront it won't show",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "notesPermanentlyUnavailable",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "Boolean",
          "inlineEditable": true,
          "editor": "Checkbox",
          "label": "Mark Notes as permanently unavailable",
          "hints": "This box is automatically ticked if no output is added after 14 days from the event's end date.",
          "placeholder": "",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "notes",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "String",
          "isUnique": false,
          "isEmbeddable": false,
          "inlineEditable": false,
          "createEnum": false,
          "contentType": "Unspecified",
          "editor": "RichText",
          "label": "Notes",
          "hints": "If permanently unavailable box is ticked, any content you put here will be ignored.",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "videoRecordingPermanentlyUnavailable",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "Boolean",
          "inlineEditable": true,
          "editor": "Checkbox",
          "label": "Mark Video Recording as permanently unavailable",
          "hints": "This box is automatically ticked if no output is added after 14 days from the event's end date.",
          "placeholder": "",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "videoRecording",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "String",
          "isUnique": false,
          "isEmbeddable": false,
          "inlineEditable": false,
          "createEnum": false,
          "contentType": "Unspecified",
          "editor": "RichText",
          "label": "Video Recording",
          "hints": "If permanently unavailable box is ticked, any content you put here will be ignored.",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "presentationPermanentlyUnavailable",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "Boolean",
          "inlineEditable": true,
          "editor": "Checkbox",
          "label": "Mark Presentation as permanently unavailable",
          "hints": "This box is automatically ticked if no output is added after 14 days from the event's end date.",
          "placeholder": "",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "presentation",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "String",
          "isUnique": false,
          "isEmbeddable": false,
          "inlineEditable": false,
          "createEnum": false,
          "contentType": "Unspecified",
          "editor": "RichText",
          "label": "Presentation",
          "hints": "If permanently unavailable box is ticked, any content you put here will be ignored.",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "meetingMaterialsPermanentlyUnavailable",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "Boolean",
          "inlineEditable": true,
          "editor": "Checkbox",
          "label": "Mark Additional Meeting Materials as permanently unavailable",
          "hints": "This box is automatically ticked if no output is added after 14 days from the event's end date.",
          "placeholder": "",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "meetingMaterials",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "Array",
          "label": "Additional Meeting Materials",
          "hints": "If permanently unavailable box is ticked, any content you put here will be ignored.",
          "placeholder": "",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        },
        "nested": [
          {
            "name": "title",
            "isHidden": false,
            "isLocked": false,
            "isDisabled": false,
            "properties": {
              "fieldType": "String",
              "isUnique": false,
              "isEmbeddable": false,
              "inlineEditable": true,
              "createEnum": false,
              "contentType": "Unspecified",
              "editor": "Input",
              "label": "Title",
              "hints": "",
              "placeholder": "",
              "isRequired": true,
              "isRequiredOnPublish": false,
              "isHalfWidth": false
            }
          },
          {
            "name": "url",
            "isHidden": false,
            "isLocked": false,
            "isDisabled": false,
            "properties": {
              "fieldType": "String",
              "pattern": "^(?:http(s)?:\\/\\/)[\\w.-]+(?:\\.[\\w\\.-]+)+[\\w\\-\\._~:\\/?#%[\\]@!\\$&'\\(\\)\\*\\+,;=.]+$",
              "patternMessage": "URL must start with http:// or https://",
              "isUnique": false,
              "isEmbeddable": false,
              "inlineEditable": true,
              "createEnum": false,
              "contentType": "Unspecified",
              "editor": "Input",
              "label": "URL",
              "isRequired": true,
              "isRequiredOnPublish": false,
              "isHalfWidth": false
            }
          }
        ]
      },
      {
        "name": "APIdata",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": false,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "UI",
          "editor": "Separator",
          "label": "API data (not changeable)",
          "hints": "if you want to edit this, go to google cal",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "description",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": true,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "String",
          "isUnique": false,
          "isEmbeddable": false,
          "inlineEditable": false,
          "createEnum": false,
          "contentType": "Unspecified",
          "editor": "TextArea",
          "label": "Description",
          "hints": "",
          "placeholder": "",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "startDateTimeZone",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": true,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "String",
          "isUnique": false,
          "isEmbeddable": false,
          "inlineEditable": false,
          "createEnum": false,
          "contentType": "Unspecified",
          "editor": "Input",
          "label": "Start Date Time Zone",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "endDate",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": true,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "DateTime",
          "editor": "DateTime",
          "label": "End Date",
          "hints": "",
          "placeholder": "",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "endDateTimeZone",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": true,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "String",
          "isUnique": false,
          "isEmbeddable": false,
          "inlineEditable": false,
          "createEnum": false,
          "contentType": "Unspecified",
          "editor": "Input",
          "label": "End Date Time Zone",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "eventLink",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": true,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "String",
          "isUnique": false,
          "isEmbeddable": false,
          "inlineEditable": false,
          "createEnum": false,
          "contentType": "Unspecified",
          "editor": "Input",
          "label": "Google Event Link",
          "hints": "",
          "placeholder": "",
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "googleId",
        "isHidden": false,
        "isLocked": false,
        "isDisabled": true,
        "partitioning": "invariant",
        "properties": {
          "fieldType": "String",
          "isUnique": true,
          "isEmbeddable": false,
          "inlineEditable": false,
          "createEnum": false,
          "contentType": "Unspecified",
          "editor": "Input",
          "label": "Google Id",
          "hints": "",
          "placeholder": "",
          "isRequired": true,
          "isRequiredOnPublish": false,
          "isHalfWidth": false
        }
      },
      {
        "name": "videoRecordingUpdatedAt",
        "properties": {
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false,
          "fieldType": "DateTime",
          "editor": "DateTime",
          "label": "Video Recording Updated At"
        },
        "isLocked": false,
        "isHidden": false,
        "isDisabled": true,
        "partitioning": "invariant"
      },
      {
        "name": "presentationUpdatedAt",
        "properties": {
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false,
          "fieldType": "DateTime",
          "editor": "DateTime",
          "label": "Presentation Updated At"
        },
        "isLocked": false,
        "isHidden": false,
        "isDisabled": true,
        "partitioning": "invariant"
      },
      {
        "name": "notesUpdatedAt",
        "properties": {
          "isRequired": false,
          "isRequiredOnPublish": false,
          "isHalfWidth": false,
          "fieldType": "DateTime",
          "editor": "DateTime",
          "label": "Notes Updated At"
        },
        "isLocked": false,
        "isHidden": false,
        "isDisabled": true,
        "partitioning": "invariant"
      }
    ],
    "previewUrls": {},
    "fieldRules": [],
    "category": "Storage",
    "isPublished": true
  },
  "name": "events",
  "isSingleton": false,
  "schemaType": "Default"
}
